import{r as l,V as p,u as F,a as q,b as U,c as P,K as G,s as V,j as s,A as Y,m as S,C as X,N as J,B as w,d as Q,e as W,X as Z,S as ee,M as A,f as se,g as te,h as ne}from"./index-cClgI0Q3.js";const ae=15e3,ie=3,re=()=>{const[C,E]=l.useState(!1),[R,d]=l.useState([{role:"assistant",content:"Namaste! I am your RAHI Assistant. How can I help you navigate our platform today?"}]),[f,T]=l.useState(""),[y,b]=l.useState(!1),[L,k]=l.useState(!1),[g,M]=l.useState(!1),[u,$]=l.useState(!0),[O,z]=l.useState(p.RACHEL_PROFESSIONAL),h=F();q();const{getChatContext:v}=U(),x=l.useRef(null);l.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[R]);const j=l.useCallback(async t=>{if(!t.trim()||g)return;const e={role:"user",content:t};d(a=>[...a,e]),T(""),M(!0);try{const a=await v(),r=new AbortController,i=setTimeout(()=>{console.warn("Chat request timed out"),r.abort()},ae),n=await fetch("http://localhost:5000/chat",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({message:t,context:a}),signal:r.signal,mode:"cors",credentials:"omit"});if(clearTimeout(i),!n.ok){const I=await n.text();throw console.error(`Backend API responded with status: ${n.status} ${n.statusText}`,I),new Error(`Backend API error: ${n.status} ${n.statusText}`)}const _=(await n.json()).reply,B=N(t);d(I=>[...I,{role:"assistant",content:_}]),B&&h(B),u||m(_)}catch(a){console.error("Error getting AI response:",a);const r=a instanceof Error?a.message:String(a);if(r.includes("fetch")||r.includes("network")||r.includes("CORS")||r.includes("TypeError")){console.warn("Network error - trying fallback to local AI...");try{const i=await v(),o=await P.sendMessage(t,i);console.debug("Local AI fallback response:",o);const n=N(t);d(c=>[...c,{role:"assistant",content:o}]),n&&h(n),u||m(o)}catch(i){console.error("Fallback AI also failed:",i);const o={role:"assistant",content:"I'm having trouble connecting to both the backend service and the local AI. Let me provide basic assistance."};d(c=>[...c,o]);const n=await H(t);d(c=>[...c,{role:"assistant",content:n.text}]),n.navigate&&h(n.navigate),u||m(n.text)}}else{console.warn("Backend processing error - trying fallback to local AI...");try{const i=await v(),o=await P.sendMessage(t,i),n=N(t);d(c=>[...c,{role:"assistant",content:o}]),n&&h(n),u||m(o)}catch(i){console.error("Fallback AI also failed:",i);const o={role:"assistant",content:"I'm having trouble connecting to both the backend service and the local AI. Let me provide basic assistance."};d(c=>[...c,o]);const n=await H(t);d(c=>[...c,{role:"assistant",content:n.text}]),n.navigate&&h(n.navigate),u||m(n.text)}}}finally{M(!1)}},[g,h,u]),N=t=>{const e=t.toLowerCase();if(e.includes("book")||e.includes("hire")||e.includes("booking")||e.includes("payment")||e.includes("pay"))return"/services";if(e.includes("track")||e.includes("status")||e.includes("where is my worker"))return"/tracking";if(e.includes("login")||e.includes("register")||e.includes("sign up"))return"/login";if(e.includes("home")||e.includes("main page"))return"/"},H=async t=>{const e=t.toLowerCase();if(e.includes("book")||e.includes("hire")||e.includes("booking"))return{text:"I can help you with that! Taking you to our booking section where you can choose a professional for your needs.",navigate:"/services"};if(e.includes("track")||e.includes("status")||e.includes("where is my worker"))return{text:"Sure! Let's check your active bookings in the tracking section.",navigate:"/tracking"};if(e.includes("login")||e.includes("register")||e.includes("sign up"))return{text:"Heading to the registration page. You can join as a Worker, Customer, or Partner!",navigate:"/login"};if(e.includes("home")||e.includes("main page"))return{text:"Returning you to the homepage.",navigate:"/"};if(e.includes("plumber")||e.includes("electrician")||e.includes("carpenter"))return{text:"You can find professionals like plumbers, electricians, and carpenters on our services page. Would you like me to take you there?",navigate:"/services"};const a=e.split(" ").filter(i=>i.length>ie);let r={content:"",score:0};if(G.forEach(i=>{let o=0;a.forEach(n=>{i.content.toLowerCase().includes(n)&&o++}),o>r.score&&(r={content:i.content,score:o})}),r.score>0){const i=r.content.split(/[.!?]/);return{text:(i.find(n=>a.some(c=>n.toLowerCase().includes(c)))||i[0]).trim()+"."}}return e.includes("commission")||e.includes("price")||e.includes("charge")?{text:"RAHI uses a fair pricing model with only 8-12% commission, which is much lower than other platforms. We believe in dignity and fair earnings for our workers."}:e.includes("urban company")||e.includes("competitor")?{text:"Unlike Urban Company, RAHI focuses on Tier-2 and Tier-3 cities, offers faster 60-second matching, and doesn't penalize workers for rejecting jobs. We're an ethical gig platform."}:e.includes("voice")||e.includes("literacy")?{text:"We specialized our app for low-literacy users with voice navigation in regional languages like Hindi, Bengali, and Marathi."}:{text:"I'm not quite sure about that. But I can help you book a service, track a professional, or tell you about our mission to empower workers. What would you like to do?"}},m=async t=>{if(!(u||!t)){k(!0);try{await V.speak(t,O)}catch(e){console.error("Speech error:",e)}finally{k(!1)}}},K=()=>{u||(V.stopSpeaking(),k(!1)),$(!u)},D=()=>{const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){alert("Speech Recognition not supported in this browser.");return}const e=new t;e.lang="en-IN",e.continuous=!1,e.interimResults=!1,e.onstart=()=>b(!0),e.onresult=a=>{const r=a.results[0][0].transcript;j(r)},e.onend=()=>{b(!1)},e.onerror=a=>{console.error("Speech recognition error",a.error),b(!1)},e.start()};return s.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col items-end",children:[s.jsx(Y,{children:C&&s.jsx(S.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},className:"mb-4 w-[350px] md:w-[400px]",children:s.jsxs(X,{className:"flex flex-col h-[500px] shadow-2xl border-primary/20 overflow-hidden glassmorphism",children:[s.jsxs("div",{className:"bg-primary p-4 text-primary-foreground flex justify-between items-center bg-gradient-to-r from-orange-500 via-white to-green-600",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-white flex items-center justify-center",children:s.jsx(J,{className:"w-5 h-5 text-orange-600"})}),s.jsx("span",{className:"font-bold text-slate-900",children:"RAHI Guide"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs("div",{className:"flex flex-col items-end",children:[s.jsx("span",{className:"text-xs text-slate-600 mb-1",children:"Voice:"}),s.jsx("select",{value:O.voiceId,onChange:t=>{const e=Object.keys(p).find(a=>p[a].voiceId===t.target.value);e&&z(p[e])},className:"bg-white border border-gray-300 rounded-md px-2 py-1 text-xs text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary min-w-[140px]",children:Object.entries(p).map(([t,e])=>s.jsx("option",{value:e.voiceId,children:e.name},t))})]}),s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-900 hover:bg-black/10",onClick:K,children:u?s.jsx(Q,{className:"h-4 w-4"}):s.jsx(W,{className:"h-4 w-4"})}),s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-900 hover:bg-black/10",onClick:()=>E(!1),children:s.jsx(Z,{className:"h-5 w-5"})})]})]}),s.jsx(ee,{className:"flex-1 p-4 bg-slate-50/50",ref:x,children:s.jsxs("div",{className:"space-y-4",children:[R.map((t,e)=>s.jsx(S.div,{initial:{opacity:0,x:t.role==="user"?10:-10},animate:{opacity:1,x:0},className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:s.jsx("div",{className:`max-w-[80%] p-3 rounded-2xl text-sm shadow-sm ${t.role==="user"?"bg-primary text-primary-foreground rounded-tr-none":"bg-white border text-slate-800 rounded-tl-none"}`,children:t.content})},e)),(L||g)&&s.jsx("div",{className:"flex justify-start",children:s.jsx("div",{className:"flex gap-1 items-center bg-white border p-2 rounded-full px-4 text-xs font-medium text-slate-500 italic",children:L?s.jsxs(s.Fragment,{children:[s.jsx(W,{className:"w-3 h-3 animate-pulse text-primary"}),"Speaking..."]}):s.jsxs(s.Fragment,{children:[s.jsx(A,{className:"w-3 h-3 animate-pulse text-primary"}),"Thinking..."]})})})]})}),s.jsxs("div",{className:"p-4 bg-white border-t flex gap-2 items-center",children:[s.jsx(w,{variant:y?"destructive":"outline",size:"icon",className:`rounded-full h-10 w-10 shrink-0 ${y?"animate-pulse":""}`,onClick:D,children:y?s.jsx(se,{className:"h-5 w-5"}):s.jsx(te,{className:"h-5 w-5"})}),s.jsx("input",{type:"text",placeholder:"Ask me anything...",className:"flex-1 bg-slate-100 border-none rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-primary outline-none",value:f,onChange:t=>T(t.target.value),onKeyDown:t=>t.key==="Enter"&&j(f),disabled:g}),s.jsx(w,{size:"icon",className:"rounded-full h-10 w-10 shrink-0 bg-primary",onClick:()=>j(f),disabled:!f.trim()||g,children:g?s.jsx(A,{className:"h-5 w-5 animate-spin"}):s.jsx(ne,{className:"h-5 w-5"})})]})]})})}),s.jsx(S.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>E(!C),className:"w-16 h-16 rounded-full bg-primary shadow-lg flex items-center justify-center text-white ring-4 ring-primary/20 bg-gradient-to-br from-orange-500 to-green-600 transition-all",children:s.jsx(A,{className:"w-8 h-8"})})]})};export{re as ChatAssistant};
